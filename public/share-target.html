<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>URLtk PWA Share Target</title>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const url = new URL(window.location);
            const params = url.searchParams;

            const fieldsToAttempt = ['url', 'text', 'title', 'description', 'name'];

            let urlToProcess = null;

            //attempt to find anything that looks like a URL
            fieldsToAttempt.forEach((field) => {
                if (urlToProcess) {
                    return;
                }

                try {
                    urlToProcess = new URL(params.get(field)).href;
                } catch (e) {
                    //no-op
                }
            });

            const targetURL = new URL(location.origin + location.pathname.replace('share-target.html', ''));
            targetURL.hash = `#/url/${encodeURIComponent(urlToProcess)}`;

            setTimeout(() => {
                document.getElementById('waiting').style.display = 'none';
                document.getElementById('errorMessage').style.display = 'block';
            }, 2000);

            location.replace(targetURL.href);
        });
    </script>
    <style>
        html, body {
            background-color: #808080;
        }

        #errorMessage {
            display: none;
        }

        #waiting {
            font-size: 5em;
            text-align: center;
            margin-top: 50vh;
            transform: translateY(-50%);
        }

        #errorMessage {
            text-align: center;
            color: white;
            font-size: 1.5em;
            margin-top: 50vh;
            transform: translateY(-50%);
        }

    </style>
</head>
<body>
<div id="waiting">‚è≥</div>
<p id="errorMessage">
    This is the share-target used by the PWA. If you see this message, something has gone wrong :(
    <br>
    <a href="/urltk/">Click here to go back to the app</a>
</p>
</body>
</html>