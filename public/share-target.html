<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>URLtk PWA Share Target</title>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const url = new URL(window.location);
            const params = url.searchParams;

            const fieldsToAttempt = ['url', 'text', 'title', 'description', 'name'];

            let urlToProcess = null;
            //attempt to find anything that looks like a URL

            fieldsToAttempt.forEach((field) => {
                if (urlToProcess) {
                    return;
                }

                try {
                    urlToProcess = new URL(params.get(field)).href;
                } catch (e) {
                    //no-op
                }
            });

            const targetURL = new URL(location.origin);
            targetURL.pathname = '/urltk/';
            targetURL.hash = `#/url/${encodeURIComponent(urlToProcess)}`;

            location.replace(targetURL.href);
        });
    </script>
</head>
<body>
<p>This is the share-target used by the PWA. If you see this message, something has gone wrong :(</p>
</body>
</html>